<!DOCTYPE html>
<html lang="en">
   <head>
      <!-- Document title -->
      <title>Welcome | Ace Electric</title>
      <meta http-equiv="content-type" content="text/html; charset=utf-8" />
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <meta charSet="utf-8" />
      <meta property="og:image:width" content="500" />
      <meta property="og:image:height" content="500" />
      <meta name="mobile-web-app-capable" content="yes" />
      <meta content="en" http-equiv="content-language" />
      <meta content="text/html; charset=UTF-8" http-equiv="Content-Type">
      <meta content="yes" name="apple-mobile-web-app-capable" />
      <meta content="true" name="HandheldFriendly" />
      <meta content="width" name="MobileOptimized" />
      <meta property="og:type" content="website" />
      <meta name="robots" content="index, follow" />
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <meta name="description" content="Ace Electric" />
      <meta property="og:title" content="Ace Electric" />
      <!-- Stylesheets & Fonts -->
      <link href="css/plugins.css" rel="stylesheet">
      <link href="css/style.css" rel="stylesheet">
      <link href='css/datatables.min.css' rel='stylesheet' />
      <script src="js/popper.min.js"></script>
      <script src="js/jquery.js"></script>
      <script type="text/javascript">

      function setCookie(cname, cvalue, exdays) {
  const d = new Date();
  d.setTime(d.getTime() + (exdays * 24 * 60 * 60 * 1000));
  let expires = "expires="+d.toUTCString();
  document.cookie = cname + "=" + cvalue + ";" + expires + ";path=/";
}

function getCookie(cname) {
  let name = cname + "=";
  let ca = document.cookie.split(';');
  for(let i = 0; i < ca.length; i++) {
    let c = ca[i];
    while (c.charAt(0) == ' ') {
      c = c.substring(1);
    }
    if (c.indexOf(name) == 0) {
      return c.substring(name.length, c.length);
    }
  }
  return "";
}


function deleteAllCookies() {
    var cookies = document.cookie.split(";");

    for (var i = 0; i < cookies.length; i++) {
        var cookie = cookies[i];
        var eqPos = cookie.indexOf("=");
        var name = eqPos > -1 ? cookie.substr(0, eqPos) : cookie;
        document.cookie = name + "=;expires=Thu, 01 Jan 1970 00:00:00 GMT";
    }
location.reload()

}


    </script>
      <style type="text/css">
         
         ::placeholder {
  color: white;
  opacity: 1; /* Firefox */
}

:-ms-input-placeholder { /* Internet Explorer 10-11 */
 color: white;
}

::-ms-input-placeholder { /* Microsoft Edge */
 color: white;
}
      </style>
   </head>
   <body style="word-break:break-word;">
      <!-- Body Inner -->
      <div class="body-inner">
      <section class="fullscreen" >
         <div class="bg-overlay" data-style="5"></div>
         <div class="shape-divider" data-style="1" data-position="top" data-flip-vertical="true"></div>
         <div class="shape-divider" data-style="1"></div>
         <div class="container">
            <div class="container-fullscreen p-t-40" style="display: block;">
                <div id="result_message" style="text-align: -webkit-center;"></div>
                <div id="contact_info"></div>
                <div id="logout"></div>
            </div>
         </div>
      </section>

      <!-- Footer -->
      <footer id="footer" class="bg-transparent">
         <div class="copyright-content">
            <div class="container">
               <div class="copyright-text text-center" >&copy; 2021 Ace Electric - All Rights Reserved.</div>
            </div>
         </div>
      </footer>
      <!-- end: Footer -->
      </div>
      <!-- end: Body Inner -->
      <!-- Scroll top -->
      <a id="scrollTop"><i class="icon-chevron-up"></i><i class="icon-chevron-up"></i></a>
      <!--Plugins-->




<script type="text/javascript">
    var login_html=`
                <div class="text-middle" style="width:-webkit-fill-available">
                  <div class="heading-text text-light m-t-50">
                     <div class="card m-t-40 col-md-6" style="background-color: #48484885;margin: auto;">
                         <div class="card-header" style="background-color:transparent;">
                             <span class="h4">Employee Login</span>
                         </div>
                         <div class="card-body">
                             <form id="formsubmission" class="form-validate" method="POST">
                                 <div class="row">
                                     <div class="col-md-12">
                                         <div class="form-group">
                                             <input class="form-control" type="text" id="username" name="username" placeholder="Username" required >
                                         </div>
                                          <div class="form-group">
                                             <input class="form-control" type="password" id="password" name="password" placeholder="Password" required >
                                         </div>
                                     </div>
                                     <div class="col-md-12">
                                         <div class="form-group">
                                             <button type="submit" class="btn btn-light  btn-outline btn-light-hover">LogIn</button>
                                         </div>
                                     </div>
                                 </div>
                             </form>
                             <div id="submitMessage" style="padding:15px"></div>
                            </div>
                         </div>
                     </div>
                  </div>`;

    function table_elements(){
            var table = $('#datatable').DataTable({
                "pageLength": 50,
                buttons: [{
                    extend: 'print',
                    title: 'CONTACT INFO',
                    exportOptions: {
                        columns: "thead th:not(.noExport)"
                    }
                }, {
                    extend: 'pdf',
                    title: 'CONTACT INFO',
                    exportOptions: {
                        columns: "thead th:not(.noExport)"
                    }
                }, {
                    extend: 'excel',
                    title: 'CONTACT INFO',
                    exportOptions: {
                        columns: "thead th:not(.noExport)"
                    }
                }, {
                    extend: 'csv',
                    title: 'CONTACT INFO',
                    exportOptions: {
                        columns: "thead th:not(.noExport)"
                    }
                
                }]
            });
            table.buttons().container().appendTo('#export_buttons');
            $("#export_buttons .btn").removeClass('btn-secondary').addClass('btn-light');
              }


    function parse_cards(data) {
            info=JSON.parse(data)
            var heading =info.shift();
            var cards = "";
            for (var i = 0; i < info.length; i++) {

                var singlerow="";
                for (var j=1;j<info[i].length;j++){
                    if (heading[j].toUpperCase().includes("CALL")){
                        singlerow=singlerow+`<span style="color:black;font-weight:500"><i class="fa fa-phone"></i> ${heading[j]} <a href="tel:${info[i][j]}">${info[i][j]}</a></span><br>`
                    }
                    else if (heading[j].toUpperCase().includes("TEXT")){
                    singlerow=singlerow+`<span style="color:black;font-weight:500"><i class="icon-message-square"></i> ${heading[j]} <a href="sms:${info[i][j]}">${info[i][j]}</a></span><br>`

                    }
                    else if (heading[j].toUpperCase().includes("EMAIL")){
                        singlerow=singlerow+`<span style="color:black;font-weight:500"><i class="icon-mail"></i> ${heading[j]} <a href="mailto:${info[i][j]}">${info[i][j]}</a></span><br>`

                    }
                    else {
                        singlerow=singlerow+`<span style="color:black;font-weight:500">${heading[j]} ${info[i][j]}</span><br>`

                    }
                }
                cards=cards+
                `<div class="col-lg-4">
                    <div class="team-member">
                        <div class="team-desc" style="width: 100%">
                            <h3>${info[i][0]}</h3>
                                ${singlerow}
                        </div>
                    </div>
                </div>`
            }

            cardstr=`<div class="row team-members team-members-left team-members-shadow m-b-40 p-t-40">${cards}</div>`;

            return cardstr;

    }


    function parse_table(data) {
            info=JSON.parse(data)
            var heading =info.shift();
            var titlestr ="";
            for (var i =0;i<heading.length;i++){
                titlestr=titlestr+`<th>${heading[i]}</th>`;
            }
            var headingstr=`<tr>${titlestr}</tr>`;

            var tabledatastr="";
            for (var i =0;i<info.length;i++){
                var singlerow="";
                for (var j=0;j<info[i].length;j++){

                    if (heading[j].toUpperCase().includes("CALL")){
                        singlerow=singlerow+`<td><a href="tel:${info[i][j]}" style = "color:white">${info[i][j]}</a></td>`
                    }
                    else if (heading[j].toUpperCase().includes("TEXT")){
                        singlerow=singlerow+`<td><a href="sms:${info[i][j]}" style = "color:white">${info[i][j]}</a></td>`


                    }
                    else if (heading[j].toUpperCase().includes("EMAIL")){
                        singlerow=singlerow+`<td><a href="mailto:${info[i][j]}" style = "color:white">${info[i][j]}</a></td>`

                    }
                    else {
                        singlerow=singlerow+`<td style = "color:white">${info[i][j]}</td>`

                    }
                }

                tabledatastr=tabledatastr+`<tr>${singlerow}</tr>`
            }


            var table_ = `<div class="row mb-3" style="justify-content:right">
                            <div class="col-lg-6 text-right">
                                <div id="export_buttons" class="mt-2"></div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-lg-12" style="display:block;overflow-x: auto;color:white">
                                <table id="datatable" class="table table-bordered table-hover" style="word-break:normal;margin:auto">
                                    <thead>
                                        ${headingstr}
                                    </thead>
                                    <tbody style = "color:white">
                                        ${tabledatastr}
                                    </tbody>
                                    <tfoot>
                                        ${headingstr}
                                    </tfoot>
                                </table>
                            </div>
                        </div>`
            return table_



    }

    function cards_to_elements(cardstr){
            $('#contact_info').html(cardstr);
            table_elements();
        } 

	let username = getCookie("username");
	let password = getCookie("password");

	if (username != ""){
		     $.ajax({
	      url: "https://script.google.com/macros/s/AKfycbyYDLE-f6caQFz9JJOjR-5-9T5dJIc6Qx8SL2pPbudfr95AUchV/exec",
	      type: "post",
	      data: {
	        "username":username,
	        "password":password
	     },
      beforeSend: function() {
   
          $("#result_message").html(`
                <div class="d-flex justify-content-center">
                   <div class="spinner-border" role="status">
                       <span class="sr-only">Loading...</span>
                   </div>
               </div>
               `);
   
       },
	     success:function(data) {
	          if (data["result"]=="Logged In") {

                logout_button=`<button class="btn btn-light btn-sm btn-outline btn-light-hover" style="z-index:100;margin:20px 20px 20px 0px" onclick="deleteAllCookies()">Log Out</button>`
                head=`<div class="heading-text heading-line text-center">
	          		<h4 style = "font-variant-caps: small-caps;color: white;font-weight: 700;">Welcome ${username}</h4>
	          	    </div>`
                cardsinfo=parse_cards(data['data']);
                tableinfo=parse_table(data['data']);
                cards_button=`<button class="btn btn-light  btn-outline btn-light-hover" style="z-index:100;" onclick="cards_to_elements(cardsinfo)">cards</button>`;
                table_button=`<button class="btn btn-light  btn-outline btn-light-hover" style="z-index:100;" onclick="cards_to_elements(tableinfo)">table</button>`;

				$('#result_message').html(head+cards_button+table_button);
	          	$('#contact_info').html(cardsinfo);
                table_elements();
                $('#logout').html(logout_button);

    	          }


			else {
					$('#result_message').html(login_html);
                    $("#submitMessage").html(`<div role="alert" class="alert alert-danger alert-dismissible" >
                  <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span> </button>
                  <strong><i class="icon-alert-circle"></i> ${data['result']}</strong>`);
                    deleteAllCookies();

			}   
	       
	    },
	    error:function (jqXHR, exception) {
	       $('#result_message').html(login_html);
            $("#submitMessage").html(`<div role="alert" class="alert alert-danger alert-dismissible" >
                  <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span> </button>
                  <strong><i class="icon-alert-circle"></i>Something went wrong....Try again</strong>`);
                    deleteAllCookies();
	   },
	   complete:function(data){
	   
	   }
	   });
	}
	else{
		$('#result_message').html(login_html);
	   }


    $('#result_message').show();

        $('#formsubmission').submit(function(e) {

          e.preventDefault();    

         var username = $('#username').val();
         var password = $('#password').val();
         $.ajax({
          url: "https://script.google.com/macros/s/AKfycbyYDLE-f6caQFz9JJOjR-5-9T5dJIc6Qx8SL2pPbudfr95AUchV/exec",
          type: "post",
          data: {
            "username":username,
            "password":password,
         },
          beforeSend: function() {

              $("#submitMessage").html(`<div class="d-flex justify-content-center">
                       <div class="spinner-border" role="status">
                           <span class="sr-only">Loading...</span>
                       </div>
                   </div>`);

           },
         success:function(data) {
              if (data["result"]=="Logged In") {
                setCookie("username", data["username"], 1);
                setCookie("password", data["password"], 1);
                
                $("#submitMessage").html(`<div role="alert" class="alert alert-success alert-dismissible" >
                 <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span> </button>
                 <strong><i class="icon-check-circle"></i> ${data['result']}</strong>`);

                logout_button=`<button class="btn btn-light btn-sm btn-outline btn-light-hover" style="z-index:100;margin:20px 20px 20px 0px" onclick="deleteAllCookies()">Log Out</button>`
                head=`<div class="heading-text heading-line text-center">
                    <h4 style = "font-variant-caps: small-caps;color: white;font-weight: 700;">Welcome ${username}</h4>
                    </div>`
                cardsinfo=parse_cards(data['data'])
                tableinfo=parse_table(data['data'])
                cards_button=`<button class="btn btn-light  btn-outline btn-light-hover" style="z-index:100;" onclick="cards_to_elements(cardsinfo)">cards</button>`;
                table_button=`<button class="btn btn-light  btn-outline btn-light-hover" style="z-index:100;" onclick="cards_to_elements(tableinfo)">table</button>`;


                $('#result_message').html(head+cards_button+table_button);
                $('#contact_info').html(cardsinfo);
                table_elements();
                $('#logout').html(logout_button);

                }
             else {

                $("#submitMessage").html(`<div role="alert" class="alert alert-danger alert-dismissible" >
              <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span> </button>
              <strong><i class="icon-alert-circle"></i> ${data['result']}</strong>`);


             }

           
        },
        error:function (jqXHR, exception) {

         $("#submitMessage").html(`<div role="alert" class="alert alert-danger alert-dismissible">
         <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span> </button>
         <strong><i class="fa fa-check-circle"></i> Warning!</strong> Something went wrong</div>`);
        },
        complete:function(data){

        }
        });

        });
       
    </script>
      <script src="js/plugins.js"></script>
      <script src="js/functions.js"></script>
      <script src='js/datatables.js'></script>
   </body>
</html>
